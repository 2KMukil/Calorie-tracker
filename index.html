
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calorie Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; background: #f9f9f9; }
    h1 { text-align: center; }
    input, button, select { width: 100%; padding: 10px; margin: 5px 0; }
    ul { list-style: none; padding: 0; }
    li { padding: 10px; border-bottom: 1px solid #ccc; }
    .total { font-weight: bold; margin-top: 20px; text-align: center; }
    .entry { background: #fff; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
    .entry span { display: block; }
    .actions button { margin-right: 5px; }
  </style>
</head>
<body>
  <h1>Calorie Tracker</h1>
  <input type="text" id="foodInput" placeholder="Enter food (e.g., 1 banana)" />
  <button onclick="addFood()">Add Food</button>

  <label for="dateFilter">Filter by Date:</label>
  <select id="dateFilter" onchange="filterByDate()">
    <option value="">All Dates</option>
  </select>

  <div id="foodList"></div>
  <div class="total">Total Calories: <span id="totalCalories">0</span></div>

  <script>
    const APP_ID = '6427e520';
    const API_KEY = 'fe520c03e0905bcefb1dcbe85d6132fb';
    let foods = JSON.parse(localStorage.getItem('foods')) || [];

    function getToday() {
      const d = new Date();
      return d.toISOString().split('T')[0];
    }

    function updateDateFilter() {
      const dates = [...new Set(foods.map(f => f.date))];
      const filter = document.getElementById('dateFilter');
      filter.innerHTML = '<option value="">All Dates</option>';
      dates.forEach(date => {
        const opt = document.createElement('option');
        opt.value = date;
        opt.textContent = date;
        filter.appendChild(opt);
      });
    }

    function filterByDate() {
      const selectedDate = document.getElementById('dateFilter').value;
      updateList(selectedDate);
    }

    function updateList(filterDate = '') {
      const list = document.getElementById('foodList');
      const total = document.getElementById('totalCalories');
      list.innerHTML = '';
      let totalCals = 0;

      foods.filter(f => !filterDate || f.date === filterDate).forEach((item, index) => {
        totalCals += item.calories;
        const div = document.createElement('div');
        div.className = 'entry';
        div.innerHTML = `
          <span><strong>${item.name}</strong> (${item.serving_qty} ${item.serving_unit})</span>
          <span>Calories: ${item.calories.toFixed(2)} | Protein: ${item.protein.toFixed(2)}g | Fat: ${item.fat.toFixed(2)}g | Carbs: ${item.carbs.toFixed(2)}g</span>
          <div class="actions">
            <button onclick="editFood(${index})">Edit</button>
            <button onclick="deleteFood(${index})">Delete</button>
          </div>
        `;
        list.appendChild(div);
      });

      total.textContent = totalCals.toFixed(2);
      localStorage.setItem('foods', JSON.stringify(foods));
      updateDateFilter();
    }

    async function fetchNutrition(query) {
      const response = await fetch('https://trackapi.nutritionix.com/v2/natural/nutrients', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-app-id': APP_ID,
          'x-app-key': API_KEY,
          'x-remote-user-id': '0'
        },
        body: JSON.stringify({ query })
      });
      const data = await response.json();
      if (data.foods && data.foods.length > 0) {
        const f = data.foods[0];
        return {
          name: f.food_name,
          calories: f.nf_calories,
          protein: f.nf_protein,
          fat: f.nf_total_fat,
          carbs: f.nf_total_carbohydrate,
          serving_qty: f.serving_qty,
          serving_unit: f.serving_unit,
          date: getToday()
        };
      } else {
        throw new Error('Food not found');
      }
    }

    async function addFood() {
      const input = document.getElementById('foodInput');
      const query = input.value.trim();
      if (!query) return;
      try {
        const foodData = await fetchNutrition(query);
        foods.push(foodData);
        updateList(document.getElementById('dateFilter').value);
        input.value = '';
      } catch (err) {
        alert(err.message);
      }
    }

    async function editFood(index) {
      const newQuery = prompt('Enter new food description:', foods[index].name);
      if (!newQuery) return;
      try {
        const updatedFood = await fetchNutrition(newQuery);
        foods[index] = updatedFood;
        updateList(document.getElementById('dateFilter').value);
      } catch (err) {
        alert(err.message);
      }
    }

    function deleteFood(index) {
      if (confirm('Delete this entry?')) {
        foods.splice(index, 1);
        updateList(document.getElementById('dateFilter').value);
      }
    }

    updateList();
  </script>
</body>
</html>
